## 第一次成功备份
> 第一次成功将ubuntu从笔记本上完全拷贝到台式机上，很开心～

- **版本** ubuntu 16.0.4 LST

备份的目录有：
- `etc` `home` `lib` `usr`

**注意：** 在tar etc目录的时候要排除文件 fstab 文件
### 还原过程
- 在台式机上安装ubuntu
- 重启，进入系统
安装完后进入系统，目的是：保存`/etc`目录下的 `fstab`文件，这个文件记录了硬盘的uuid
- 完全关闭电脑，再开机，进入u盘中的ubuntu系统
如果是**重启**电脑的话，一些文件不能释放，当替换的时候会报错
在u盘系统中用之前备份的四个目录替换了台式机中的对应目录，将保存的fstab文件放回`etc`目录中
- 重启，完成恢复


## 增量备份（待测试）
- **目标**
只备份后面安装应用所产生的文件，包括新增的依赖库`/usr/lib`，二进制文件`/usr/bin`等
- **实现**
使用`tar`命令，在装好系统后先做一个初始tar包，之后在需要备份的时候仅备份与初始tar包中不同的文件（通过script）实现
  * 建立初始包（第一次备份）
`tar -g snapshot -zcf back01.tar.gz sourcedir`
-g 后面指定快照名，默认是保存在当前路径，增量备份的原理是通过与快照中的数据比对来区分有差异的数据，找出有差异的数据后将其保存（目测：快照中的数据为各文件的hash值） 
  * 第二次备份
`tar -g snapshot -zcf back02.tar.gz sourcedir`
在back02.tar.gz中保存的是和back01.tar.gz不同的文件
第三次备份，是与前两次备份不同的数据，以snapshot中的记录来操作。

> 如果每次只想保存和第一次有差异的文件，可以先将snapshot拷贝一个副本，再备份文件
  

ubuntu下备份/etc需要注意fstab文件，要保留原来的fstab文件，备份home的时候，由于将home单独分出去了，所以需要先挂载再备份

## 测试
** 在刚开始的时候做好逻辑分区（LVM），后面调整分区会变得容易
### 使用命令
- `dd` 直接拷贝扇区：`sudo dd if=/dev/sda1 of=/tmp/mbr.backup count=1 bs=512` - 拷贝一个大小为512的区块到文件mbr.backup中
- `mkisofs` 制作iso镜像(非必要)

**一个想法**：使用dd只拷贝文件系统中存储数据的部分，这样就可以使用很小的空间备份整个系统，在恢复的时候将文件拷贝至硬盘中，再对硬盘进行resize
**分析**：系统中文件的存储区块不一定是连续的，因此需要通过某种方法找到磁盘中系统中存储数据的区块

**一个备份硬盘的例子**
备份/dev/hdb全盘数据，并利用gzip工具进行压缩，保存到指定路径
dd if=/dev/hdb | gzip > /root/image.gz
将压缩的备份文件恢复到指定盘
gzip -dc /root/image.gz | dd of=/dev/hdb

机械硬盘的读写速度只有30M
